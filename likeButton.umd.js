!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.likeButton=e():t.likeButton=e()}(this,function(){return function(t){function e(o){if(i[o])return i[o].exports;var n=i[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,o){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=2)}([function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAQAAABKfvVzAAABE0lEQVR4Ac3LweuLARyA8c/bb7elRslxLZID2i5OykXYhSRONLlsf8JSDtxWCkUObhy5SVJykgsnDu5jkxxYi7Z58/UebK3V+/Y68XnOj3/mUNZfeeA+5e0yN7NTaVeEcFlJFR+9y/pgSynnhK6ecEahmr0OO+2Nr6pZ37x21hH77JBYp29kLlbdADfFqoWxvpXEQPjluguOa6mCqpYTOn/GgYR1PamhAzbtN5Tqwqa2qYlj1h01MdWWo2nkp7qluoWRpgKPTG1ZqvjuoUKfPAennAQvjBXYI1y12xMhPNZwTWjI1RGemUndykr98FQ4L9c9Ibx0EDS9EsJdud777KLEUuKSL97KUXNbzabt7tjmf/Yb2Ttcq8+0JAYAAAAASUVORK5CYII="},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAQAAABKfvVzAAAAzklEQVR4Ac3NMSuEcRzA8c8Tq3oMMlp043WThV3GMxgspJSXcCmzjAqLjcHiZUgpk8WOS7KxuFz9PMOlPP3v32Pi830BX39moepXzp3R3KyBDzMa2xPCroYmPQnhwYRG1sSoVVmlliVdt2LUja5FLaWanr6ByDTQ1/OtcCDk21f4YcdQSPdpW8KKd5HozTJpHX1R61FbxqWodSHrOXHImBeJ5oy1IVQZOqwaClXWjXUqhCtt0HEthBNj3XuxqQBQ2PLqjrTSkVLdtGNT/rMveWmS+mb4BNsAAAAASUVORK5CYII="},function(t,e,i){var o=i(3);registerPlugin(proto(Gem,function(){this.name="LikeButton",this.initialize=function(t){return{likesField:"likes"}},this.requireFields=function(t){var e={};return e[t.likesField]={type:"choice",list:!0,choices:"Users"},e},this.build=function(t,e,n){var r=this;this.api=n,this.ticket=t;var s=Image(i(0)),l=Text(t.get(this.likesField).subject.length);this.whoLiked=Text("");var c=Block(s,drop=o(l,this.whoLiked));this.add(c),this.likesField=e.subject.likesField,console.log("likesField ",t.get(this.likesField)),t.get(this.likesField).subject.length>0&&n.User.current().then(function(e){console.log("user ",e),t.get(r.likesField).subject.forEach(function(t){e.subject._id===t&&(s.src=i(1))})}).then(function(){return r.getAllLikers()}).done(),s.on("click",function(){n.User.current().then(function(e){var o=t.get(r.likesField).subject.indexOf(e.subject._id);-1===o?(t.get(r.likesField).push(e.subject._id),s.src=i(1)):(t.get(r.likesField).splice(o,1),s.src=i(0),l.text=t.get(r.likesField).subject.length,r.getAllLikers())}).done()}),t.get(this.likesField).on("change",function(){r.getAllLikers(),l.text=t.get(r.likesField).subject.length}),l.on("mouseover",function(){drop.open()}),l.on("mouseout",function(){drop.close()})},this.getAllLikers=function(){var t=this;this.api.User.load(this.ticket.get(this.likesField).subject).then(function(e){console.log("users = ",e),0===e.length||void 0===e?(drop.close(),t.whoLiked.text=""):Users.forEach(function(e,i){t.whoLiked.text=1===i?e.displayName():", "+e.displayName()})}).done()},this.getStyle=function(){return Style({Image:{cursor:"pointer"},Block:{border:"1px solid #ccc",Text:{display:"block",marginBottom:3}}})}}))},function(t,e){function i(t,e,i){var n=t.button.domNode.getBoundingClientRect(),r=t.dropdown;if(n.bottom>e.top&&n.top<e.bottom&&n.right>e.left&&n.left<e.right){var s=getComputedStyle(t.dropdown.domNode);o("v",r,s,n,i),o("h",r,s,n,i),r.visible=!0}else t.dropdown.visible=!1}function o(t,e,i,o,n){if("v"===t)var r="bottom",s="top",l="height",c="direction",d="getPotentialHeight",a="scrollHeight",u="clientHeight";else var r="right",s="left",l="width",c="horizontalDirection",d="getPotentialWidth",a="scrollWidth",u="clientWidth";if("v"===t)var p=o[s],f=o[r],g=1;else var p=o[r],f=o[s],g=0;var v=h(i,"margin-"+s),m=h(i,"margin-"+r),b=v+m;if(void 0!==e[d])var A=e[d]();else var A=e.domNode[a];var y=f+A+b-document.documentElement[u],k=A+b-p;if(y<0)var x=1,w=f-g;else if(k<0)var x=-1,w=p-A+g;else if(y<k)var x=1,j=A+m-y,w=f-g;else var x=-1,j=A+v-k,w=j-p+g;e.domNode.style[s]=w+"px",void 0!==j?(n||e.state.subject[l]!==j)&&(e.domNode.style[l]=j+"px",e.state.set(l,j)):(n||void 0!==e.state.subject[l])&&(e.domNode.style[l]="",e.state.set(l,void 0)),(n||e.state.subject[c]!==x)&&e.state.set(c,x)}function n(t,e){var i=t[0],o=t[1];for(var r in o)Object.hasOwnProperty.call(o,r)&&(e&&i[r]instanceof Object&&o[r]instanceof Object?n([i[r],o[r]],!0):i[r]=o[r]);if(t.length>2){return n([i].concat(t.slice(2)),e)}return i}function r(t){return Array.prototype.slice.call(t,0)}var s=Style({overflowY:"scroll"}),l=proto(Gem,function(t){this.name="dropDown",this.dropdownMenuStyle=Style({display:"block",position:"absolute",border:"1px solid black",marginTop:2,padding:2,backgroundColor:"white",zIndex:1e3,$state:function(t){if(void 0!==t.height)return s}}),this.defaultStyle=Style({$setup:function(t,e){var i=c(e.componentStyleMap,t.dropdown);if(i){i=t.dropdownMenuStyle.mix(i).copy();var o=i.componentStyleMap;i.componentStyleMap={},void 0!==t.parent&&u(i.componentStyleMap,t.parent.computedStyleMap),u(i.componentStyleMap,e.componentStyleMap,o)}else i=t.dropdownMenuStyle;t.dropdown.style=i},$kill:function(t){t.dropdown.style=void 0},$wrapper:{display:"block",position:"static"}}),this.build=function(){if(void 0===arguments[0]||"string"==typeof arguments[0])var t=arguments[0],e=1;else var e=0;this.button=arguments[e],this.dropdown=arguments[e+1],this.maintainDropdownPosition=arguments[e+2],void 0===this.maintainDropdownPosition&&(this.maintainDropdownPosition=!0),this.label=t,this.isOpen=!1,this.dropdown.domNode.style.position="absolute",this.button.label="button",this.add(this.button)},this.close=function(){this.isOpen&&(this.isOpen=!1,this.dropdown.detach(),void 0!==this.interval&&clearInterval(this.interval),this.emit("close"))},this.open=function(){if(!this.isOpen){this.isOpen=!0;var t=this,e=p(this.domNode,"y"),o=e.getBoundingClientRect();this.maintainDropdownPosition?this.interval=setInterval(function(){i(t,o)},50):setTimeout(function(){i(t,o)},50),t.dropdown.attach(),t.emit("open")}},this.toggle=function(){this.isOpen?this.close():this.open()}}),c=function(t,e){if(void 0!==t)return d(t,e)||a(t,e)},d=function(t,e){if(void 0!==e.label&&"$"+e.label in t)return t["$"+e.label]},a=function(t,e){for(var i=e.constructor;void 0!==i;){var o=t[i.name];if(void 0!==o)return o;i=i.parent}},u=function(t,e){return n(r(arguments),!1)},p=function(t,e){for(var i=t.parentNode;;){var o=window.getComputedStyle(i).getPropertyValue("overflow-"+e);if(null===i.parentNode||i.parentNode===document||"visible"!==o&&""!==o)break;i=i.parentNode}return i},h=function(t,e){var i=t.getPropertyValue(e);return parseInt(i.slice(0,i.length-2),10)};t.exports=l}])});